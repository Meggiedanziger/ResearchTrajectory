---
title: 'Balancing sensitivity and specificity in preclinical research'
author: "Meggie Danziger, Ulrich Dirnagl, Ulf Toelch"
csl: nature-methods.csl
indent: yes
output: bookdown::pdf_document2
# output: bookdown::word_document2
latex_engine: xelatex #or lualatex
keep_tex: true
toc: false
fig_caption: yes
linestretch: 1.5
header-includes:
         # \usepackage{subfig}
         # \usepackage{ulem}
         # \usepackage{float} \floatplacement{figure}{H} 
         # \newcommand{\beginsupplement}{\setcounter{table}{0}                              \renewcommand{\thetable}{S\arabic{table}}\setcounter{figure}{0}                  \renewcommand{\thefigure}{S\arabic{figure}}}
         # \usepackage{booktabs}
fontsize: 11pt

abstract: \singlespacing The success of scientific discovery in preclinical drug development is based on the different roles of exploration and confirmation. Exploration requires sensitivity while confirmation needs to be specific. Based on published empirical data, we simulated two preclinical research trajectories to examine their effectiveness to detect true effects while keeping animal numbers low. We compare a conventional *p*-value based approach with a method based on an *a priori* determined smallest effect size of interest (SESOI). Using a SESOI increases transition rates from exploration to confirmation and results in higher detection rates across the trajectory. Specificity in the SESOI trajectory increases if the prior probability of true effects is low. We conclude that employing a SESOI is superior to a *p*-value based approach. Based on our findings, we propose a reconsideration of planning and conducting preclinical experiments, especially when the prior probability of true hypotheses is low.

bibliography: refs_repro.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
# options(tinytex.verbose = TRUE)
```

```{r libraries, echo = FALSE, message = FALSE, warning = FALSE}
library(bookdown)
library(knitr)
library(tidyverse)
library(cowplot)
library(grid)
library(gridExtra)
library(ggpubr)
library(ggplot2)
```

```{r data, include = FALSE, cache = FALSE}
load("exploratory_data_sesoi_Carneiro.RData")
exp_sesoi_Carneiro <- exploratory_data_sesoi
load("exploratory_data_sig_0.05_Carneiro.RData")
exp_sig_Carneiro <- exploratory_data_sig
load("sesoi_data_after_replication_Carneiro.RData")
rep_sesoi_Carneiro <- sesoi_data_after_replication
load("standard_data_after_replication_Carneiro.RData")
rep_sig_Carneiro <- standard_data_after_replication
load("exploratory_data_sig.RData")
load("exploratory_data_sesoi.RData")
load("all_outcomes.RData")
load("outcomes_sesoi_exploration.RData")
load("outcomes_standard_exploration.RData")
load("original_ES_distribution.RData")
load("standard_data_after_replication.RData")
load("sesoi_data_after_replication.RData")
load("ES_data_Carneiro.RData")
load("all_outcomes_Carneiro.RData")
load("outcomes_standard_exploration_30eu.RData")

```

```{r results data, echo = FALSE, message = FALSE}
# data for results section main outcomes

outcomes_standard_exp <-
  outcomes_standard_exp %>% 
  filter(pval_threshold == 0.05) %>% 
  filter(init_sample_size == 10) %>%
  filter(SESOI == 0.5 | SESOI == 1.0)

outcomes_sesoi_exp <-
  outcomes_sesoi_exp %>% 
  filter(init_sample_size == 10) %>%
  filter(SESOI == 0.5 | SESOI == 1.0)

res_data <-
  res %>%
  filter(init_sample_size == 10) %>%
  filter(trajectory != "SESOI-Standard") %>%
  filter(trajectory != "Standard-SESOI") %>%
  filter(SESOI == 0.5 | SESOI == 1.0) %>%
  filter(is.na(pval_threshold) | pval_threshold == 0.05)

```

# Main {-}

\ \ \ \ Preclinical research is essential for identifying promising therapeutic interventions and to generate robust evidence to support their translation to humans. To achieve these goals, experiments are conducted in two different operating modes [@kimmelman2014distinguishing]. Early-stage preclinical experiments are *exploratory* with the aim to discover potentially effective interventions and generate hypotheses. These are tested at a later stage under more strict conditions in *confirmatory* mode [@landis2012call].

This sequential approach putatively increases the likelihood that generated evidence is robust and potentially reduces translational failures [@dirnagl2016thomas; @mogil2017no; @drude2021science]. But which exploratory results are promising and worthwhile to confirm? Here we compare two approaches to select and conduct confirmatory studies with regard to their success in discovering true effects. In one approach, decisions for selecting a study are based on the *p*-value, the ubiquitous criterion in the biomedical publication record. An alternative approach focuses on an *a priori* defined smallest effect size of interest (SESOI), similar to a minimally clinically important difference in clinical trials [@chuang2011role].

The effectiveness of any approach is based on the different roles exploration and confirmation fulfill in scientific discovery. Via sensitive tests exploration detects potentially relevant effects among many hypotheses that often have a low prior probability of being true. The sensitivity of a test gives the probability of correctly identifying true effects (also known as the true positive rate or power). As more sensitive criteria invite more false positive results, confirmation must aim at reducing false positives to ensure that only true effects are carried forward to subsequent testing. Specificity, on the other hand, is the ability of a test to correctly reject null effects. The complement of sensitivity is the false negative rate, i.e., the more sensitive a test is the fewer true effects are missed. Likewise, the false positive rate is complementary to specificity. In the null hypothesis significance testing (NHST) framework, for example, the specificity is 95 %, if we allow a false positive rate of 5 % under the assumption that the null hypothesis is true. In any screening process, sensitivity and specificity have to be weighed against each other [@howells2012improving] as the two are inversely linked, i.e., raising sensitivity entails a drop in specificity and vice versa [@kane2021science]. To complicate matters, ethical, time, and budget constraints limit degrees of freedom in experimental design. Consequently, to prevent false negative results in exploration and to reduce false positives during confirmation, it is necessary to devise strategies to optimize these complementary goals when advancing from exploration to confirmation. Specifically, the likelihood of false negative and false positive outcomes needs to be balanced with the goal to minimize the number of animals needed. 

To this end, we simulated two preclinical research trajectories each comprising an exploratory study and a subsequent confirmatory study (Fig. \@ref(fig:figure1)a). We based our simulations on a published effect size distribution derived from empirical research [@bonapersona2021increasing] (Fig. \@ref(fig:figure1)b). After an initial exploratory study using a two-sided two-sample Welch's *t*-test, a decision criterion selected experiments to advance from exploratory to confirmatory mode. One trajectory (Standard) employed the conventional significance threshold ($\alpha$ = .05) for this decision. The second trajectory (SESOI) used a more lenient threshold based on an *a priori* defined smallest effect size of interest. For this, we estimated the effect size of each exploratory study and its 95 % confidence interval (CI). We examined whether this CI covered our SESOI (Hedges' *g* of 0.5 and 1.0, respectively). Importantly, we did not consider significance, thus, with this method significant and non-significant results were carried forward to confirmation.

We compared the two trajectories with regard to how well they meet the complementary goals of exploration and confirmation. Specifically, we were interested in the number of studies that transition from exploration to confirmation, the number of animals  needed in confirmation as well as the false negative rate (FNR), false positive rate (FPR), positive predictive value (PPV) and negative predictive value (NPV). 

```{r ES distribution, echo = FALSE, results = "hide"}

abs(meta$yi)

min(abs(meta$yi))
max(abs(meta$yi))
mean(abs(meta$yi))
median(abs(meta$yi))

```

```{r figure1, echo = FALSE, message = FALSE, out.width = '95%', fig.align = 'center', fig.cap = '\\textsf{\\textbf{Preclinical research trajectory and transition rates.} \\textbf{a}, Along the trajectory, two decisions have to be made. DECISION 1: Which experiments should move from exploration to confirmation? DECISION 2: How should the sample size for a confirmatory study (i.e. within-lab replication) be estimated? The yellow and blue panels display the decision criteria and approaches to estimate the sample size along the two  tajectories that were compared in this study (yellow = Standard; blue = SESOI). \\textbf{b}, Distribution of empirical effect sizes (\\textit{n} = 2729) extracted from Bonapersona \\textit{et al}., 2021. \\textbf{c-e}, Exploratory effect sizes (\\textit{n} = 9958, values  > 10 were removed for better display). The shaded bars show the effect sizes that were detected using one of the two decision criteria. \\textbf{c}, Yellow shaded bars indicate those effect sizes that were identified for confirmation using the conventional significance threshold ($\\alpha$ = .05). \\textbf{d}, Dark blue shaded bars indicate effect sizes that were selected using a SESOI of 0.5. \\textbf{e}, Light blue shaded bars indicate effect sizes that were selected using a SESOI of 1.0.}'}

triangle <-
  data.frame(x = c(7, 7, 13),
             y = c(2.47, 1.5, 1.5))

triangle2 <- 
  data.frame(x2 = c(15, 15, 21),
             y2 = c(2.47, 1.5, 1.5))

trajectory <- 
  ggplot() +
  geom_rect(aes(xmin = 0, xmax = 28,
                ymin = 0, ymax = 3.5),
            fill = "white") +
  geom_segment(aes(x = 0, xend = 28,
                   y = 1, yend = 1),
               size = .4,
               arrow = arrow(length = unit(0.4,"cm")),
               color = "grey34") +
  xlab("Preclinical trajectory") +
  geom_rect(aes(xmin = 7, xmax = 13,
                ymin = -0.5, ymax = 0.5),
            fill = "white",
            color = "grey34",
            size = 0.3) +
  annotate("text",
           x = 10, y = 0,
           label = "DECISION 1",
           color = "black",
           size = 3) +
  geom_rect(aes(xmin = 15, xmax = 21,
                ymin = -0.5, ymax = 0.5),
            fill = "white",
            color = "grey34",
            size = 0.3) +
  annotate("text",
           x = 18, y = 0,
           label = "DECISION 2",
           color = "black",
           size = 3) +
  geom_rect(aes(xmin = 0, xmax = 4,
                ymin = 2, ymax = 3),
            fill = "grey34",
            color = "grey34") +
  annotate("text",
           x = 2.05, y = 2.5,
           label = "EXPLORATORY \nSTUDY",
           color = "white",
           size = 2.5) +
  geom_rect(aes(xmin = 7, xmax = 13,
                ymin = 2.5, ymax = 3.5),
            fill = "#E69F00",
            color = "white") +
  annotate("text",
           x = 10, y = 3,
           label = "Conventional \nsignificance threshold",
           color = "black",
           size = 2.8) +
  geom_rect(aes(xmin = 7, xmax = 13,
                ymin = 1.5, ymax = 2.5),
            fill = "#0072B2",
            color = "white") +
  geom_polygon(aes(x = x, y = y),
               data = triangle, 
               fill = "#adcee6") +
  annotate("text",
           x = 10, y = 2,
           label = "SESOI within \nconfidence interval",
           color = "black",
           size = 2.8) +
  geom_segment(aes(x = 4, xend = 7,
                   y = 2.5, yend = 3),
               size = 0.3,
               arrow = arrow(length = unit(0.2,"cm")),
               color = "grey34") +
  geom_segment(aes(x = 4, xend = 7,
                   y = 2.5, yend = 2),
               size = 0.3,
               arrow = arrow(length = unit(0.2,"cm")),
               color = "grey34") +
  geom_rect(aes(xmin = 15, xmax = 21,
                ymin = 2.5, ymax = 3.5),
            fill = "#E69F00", 
            color = "white") +
  annotate("text",
           x = 18, y = 3,
           label = "Exploratory \neffect size",
           color = "black",
           size = 2.8) +
  geom_rect(aes(xmin = 15, xmax = 21,
                ymin = 1.5, ymax = 2.5),
            fill = "#0072B2", 
            color = "white") +
  geom_polygon(aes(x = x2, y = y2),
               data = triangle2,
               fill = "#adcee6") +
  annotate("text",
           x = 18, y = 2,
           label = "SESOI",
           color = "black",
           size = 2.8) +
  geom_segment(aes(x = 13, xend = 15,
                   y = 3, yend = 3),
               size = 0.3,
               arrow = arrow(length = unit(0.2,"cm")),
               color = "grey34") +
  geom_segment(aes(x = 13, xend = 15,
                   y = 2, yend = 2),
               size = 0.3,
               arrow = arrow(length = unit(0.2,"cm")),
               color = "grey34") +
  geom_rect(aes(xmin = 24.1, xmax = 28.1,
                ymin = 2, ymax = 3),
            fill = "grey34",
            color = "grey34") +
  annotate("text",
           x = 26.15, y = 2.5,
           label = "CONFIRMATORY \nSTUDY",
           color = "white",
           size = 2.5) +
  geom_segment(aes(x = 21, xend = 24,
                   y = 3, yend = 2.5),
               size = 0.3,
               arrow = arrow(length = unit(0.2,"cm")),
               color = "grey34") +
  geom_segment(aes(x = 21, xend = 24,
                   y = 2, yend = 2.5),
               size = 0.3,
               arrow = arrow(length = unit(0.2,"cm")),
               color = "grey34") +
  theme_bw() +
  theme(
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank(),
    axis.line = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.title.x = element_text(size = 11),
    axis.title.y = element_blank(),
    legend.text = element_text(size = 12),
    legend.title =  element_blank(),
    panel.border = element_blank(),
    text = element_text(colour = "black"))

meta_small <-
  meta %>% 
  filter(abs(yi) <= 10)

original_ES_distribution <- 
  ggplot(meta_small, aes(x = abs(yi))) + 
  geom_histogram(bins = 60, 
                 color = "black", 
                 size = 0.1,
                 fill = "white") +
 labs(x = expression(paste("Empirical effect sizes (Hedges' ", italic("g"), ") ")),
       y = "Frequency") +
  theme_cowplot(line_size = 0.3) +
  theme(axis.title.x = element_text(size = 8)) +
  theme(axis.title.y = element_text(size = 8)) +
  theme(axis.text.x = element_text(size = 7, colour = "black")) +
  theme(axis.text.y = element_text(size = 7, colour = "black"))

# original_ES_distribution

exploratory_data_sig_10 <-
  exploratory_data_sig %>%
  filter(init_sample_size == 10) %>% 
  filter(pval_threshold == 0.05) %>% 
  filter(hedges <= 10)

exploratory_data_sig_10_pos <-
  exploratory_data_sig %>%
  filter(init_sample_size == 10) %>% 
  filter(pval_threshold == 0.05) %>% 
  filter(hedges <= 10) %>% 
  filter(hedges > 0) %>%
  filter(selection == 1)

# create labels for panels b, c, d
label_sig <- grobTree(textGrob("Significance threshold = 0.05", 
                      x = 0.26,  y = 0.8, hjust = 0,
                      gp = gpar(fontsize = 7.5)))

label_sesoi_0.5 <- grobTree(textGrob("SESOI = 0.5", 
                            x = 0.3,  y = 0.8, hjust = 0,
                            gp = gpar(fontsize = 7.5)))

label_sesoi_1.0 <- grobTree(textGrob("SESOI = 1.0", 
                            x = 0.3,  y = 0.8, hjust = 0,
                            gp = gpar(fontsize = 7.5)))

ES_histrogram_selected_sig <-
  ggplot(data = exploratory_data_sig_10,
         aes(x = hedges)) +
  geom_histogram(bins = 60, color = "black", size = 0.1,
                 fill = "white") +
  geom_histogram(data = exploratory_data_sig_10_pos,
                 aes(x = hedges), 
                 bins = 60, color = "black", size = 0.1,
                 fill = "#E69F00") +
  labs(x = expression(paste("Exploratory effect sizes (Hedges' ", italic("g"), ") ")),
       y = "Frequency") +
  theme_cowplot(line_size = 0.3) +
  theme(axis.title.x = element_text(size = 8)) +
  theme(axis.title.y = element_text(size = 8)) +
  theme(axis.text.x = element_text(size = 7, colour = "black")) +
  theme(axis.text.y = element_text(size = 7, colour = "black")) +
  annotation_custom(label_sig)

# ES_histrogram_selected_sig

exploratory_data_sesoi_10 <-
  exploratory_data_sesoi %>%
  filter(init_sample_size == 10) %>% 
  filter(SESOI == 0.5) %>% 
  filter(hedges <= 10)

exploratory_data_sesoi_10_pos <-
  exploratory_data_sesoi %>%
  filter(init_sample_size == 10) %>% 
  filter(SESOI == 0.5) %>% 
  filter(hedges <= 10) %>% 
  filter(hedges > 0) %>%
  filter(selection == 1)

ES_histrogram_selected_sesoi <-
  ggplot(data = exploratory_data_sesoi_10,
         aes(x = hedges)) +
  geom_histogram(bins = 60, color = "black", size = 0.1,
                 fill = "white") +
  geom_histogram(data = exploratory_data_sesoi_10_pos,
                 aes(x = hedges), 
                 bins = 60, color = "black", size = 0.1,
                 fill = "#0072B2") +
  labs(x = expression(paste("Exploratory effect sizes (Hedges' ", italic("g"), ") ")),
       y = "Frequency") +
  theme_cowplot(line_size = 0.3) +
  theme(axis.title.x = element_text(size = 8)) +
  theme(axis.title.y = element_text(size = 8)) +
  theme(axis.text.x = element_text(size = 7, colour = "black")) +
  theme(axis.text.y = element_text(size = 7, colour = "black")) +
  annotation_custom(label_sesoi_0.5)

# ES_histrogram_selected_sesoi

exploratory_data_sesoi_10_pos_1.0 <-
  exploratory_data_sesoi %>%
  filter(init_sample_size == 10) %>%
  filter(SESOI == "1.0") %>%
  filter(hedges <= 10) %>% 
  filter(hedges > 0) %>%
  filter(selection == 1)

ES_histrogram_selected_sesoi_1.0 <-
  ggplot(data = exploratory_data_sesoi_10,
         aes(x = hedges)) +
  geom_histogram(bins = 60, color = "black", size = 0.1,
                 fill = "white") +
  geom_histogram(data = exploratory_data_sesoi_10_pos_1.0,
                 aes(x = hedges), 
                 bins = 60, color = "black", size = 0.1,
                 fill = "#adcee6") +
  labs(x = expression(paste("Exploratory effect sizes (Hedges' ", italic("g"), ") ")),
       y = "Frequency") +
  theme_cowplot(line_size = 0.3) +
  theme(axis.title.x = element_text(size = 8)) +
  theme(axis.title.y = element_text(size = 8)) +
  theme(axis.text.x = element_text(size = 7, colour = "black")) +
  theme(axis.text.y = element_text(size = 7, colour = "black")) +
  annotation_custom(label_sesoi_1.0)

# ES_histrogram_selected_sesoi_1.0

ggdraw(xlim = c(0, 2),
       ylim = c(0, 3)) +
  draw_plot(original_ES_distribution, 0.1, .84, .8, .93) +
  draw_plot(ES_histrogram_selected_sig, 1.1, .84, .8, .93) +
  draw_plot(ES_histrogram_selected_sesoi,  0.1, 0, .8, .93) +
  draw_plot(ES_histrogram_selected_sesoi_1.0, 1.1, 0, .8, .93) +
  draw_plot(trajectory, 0, 1.7, 2, 1.3, scale = 0.93) +
draw_plot_label(c("a", "b", "c", "d", "e"),
                c(0, 0, 1, 0, 1),
                c(3, 1.77, 1.77, .93, .93),
                size = 8.5)

```

# Results {-}

## Transition rates from exploration to confirmation {-}

Of the 10000 simulated exploratory studies, more experiments were selected for transition to the confirmatory phase in the SESOI trajectory compared to the Standard trajectory (SESOI 0.5: `r outcomes_sesoi_exp$selected[1]`, SESOI 1.0: `r outcomes_sesoi_exp$selected[2]`, Standard: `r outcomes_standard_exp$selected[1]`). Of the selected experiments, we removed those that had exploratory effect sizes < 0. We consider the scenario that such effects would be further investigated highly unlikely. Thus, in the SESOI trajectory `r outcomes_sesoi_exp$selected_pos[1]` (SESOI = 0.5) and `r outcomes_sesoi_exp$selected_pos[2]` (SESOI = 1.0) experiments transitioned to confirmation whereas `r outcomes_standard_exp$selected_pos[1]` experiments proceeded in the Standard trajectory (Fig. \@ref(fig:figure1)c--e). Importantly, we compared how reliably each of the two trajectories detected effects of a given size. As reference effect sizes, we chose 0.5 and 1.0. to be our effect sizes of interest. Among the 10000 sampled effect sizes that we used for our simulation, `r res_data$all_positives[1]` were $\geq$ 0.5 and `r res_data$all_positives[2]` were $\geq$ 1.0. Of those, `r outcomes_sesoi_exp$true_pos[1]` and `r outcomes_sesoi_exp$true_pos[2]` were detected using a SESOI of 0.5 and 1.0, respectively. Using a significance threshold of $\alpha$ = .05 resulted in `r outcomes_standard_exp$true_pos[1]` and `r outcomes_standard_exp$true_pos[2]` correctly identified effects. The transition rates demonstrate that the significance threshold risks to discard potentially meaningful effects at early stages of discovery (Fig. \@ref(fig:figure2)a). The SESOI criterion reduced false negatives compared to the conventional significance threshold, but at the same time made much more confirmatory studies necessary.

```{r figure2, echo = FALSE, message = FALSE, out.width = '95%', fig.align = 'center', fig.cap = '\\textsf{\\textbf{Sample sizes in confirmation and significant effect sizes after replication.} \\textbf{a}, Underlying effect sizes that were not detected during exploration using either the conventional significance threshold ($\\alpha$ = .05, yellow shaded bars) or a SESOI of 0.5 (dark blue shaded bars). 2154 effects > 0.5 were falsely eliminated when the significance criterion was employed compared to 172 if a SESOI of 0.5 was applied. \\textbf{b}, Number of animals needed in the confirmatory study. In the Standard trajectory, sample sizes are low ($n_{rep}$ = 8.08 $\\pm$ 4.05), as they are based on large exploratory effect sizes. Error bars represent standard deviations. In case of trajectories using a SESOI, the number of animals is fixed. Using a SESOI of 0.5 results in $n_{rep}$ = 23, whereas a SESOI of 1.0 achieves a sample size comparable to those in the Standard trajectory ($n_{rep}$ = 7). All sample sizes displayed and reported in the text are the number of animals needed in \\textit{each} group (control and intervention). \\textbf{c}, The histogram displays the distribution of sampled effect sizes (\\textit{n} = 9875, values $>$ 5 were removed for better display), that constituted our underlying true effect sizes in the simulation. Shaded bars indicate which underlying effect sizes were detected in the two-stage process. Dark blue shaded bars represent effect sizes that were detected across the SESOI trajectory employing a SESOI of 0.5. Light blue bars represent effect sizes that were detected employing a SESOI of 1.0. Yellow shaded bars indicate effect sizes that were detected across the Standard trajectory. As the histogram illustrates, using the Standard trajectory for discovery is not efficient as it overlooks numerous potentially meaningful effects.}'}

exploratory_data_sig_not_selected <-
  exploratory_data_sig %>% 
  filter(init_sample_size == 10) %>% 
  filter(pval_threshold == 0.05) %>% 
  filter(selection == 0 | hedges < 0) %>% 
  filter(ES_true >= 0.5)

exploratory_data_sesoi_not_selected <-
  exploratory_data_sesoi %>% 
  filter(init_sample_size == 10) %>% 
  filter(SESOI == 0.5) %>% 
  filter(selection == 0 | hedges < 0) %>% 
  filter(ES_true >= 0.5)

plot_exploratory_data_not_selected <- 
ggplot(data = exploratory_data_sig_not_selected) +
  geom_histogram(aes(x = ES_true),
                 bins = 50, color = "black", size = 0.1,
                 fill = "#E69F00") +
  geom_histogram(data = exploratory_data_sesoi_not_selected,
                 aes(x = ES_true),
                 bins = 50, color = "black", size = 0.1,
                 fill = "#0072B2") +
  labs(x = expression(paste("Effect sizes (Hedges' ", italic("g"), ") not detected in exploration")),
       y = "Frequency") +
  theme_cowplot(line_size = 0.3) +
  theme(axis.title.x = element_text(size = 9)) +
  theme(axis.title.y = element_text(size = 9)) +
  theme(axis.text.x = element_text(size = 8, colour = "black")) +
  theme(axis.text.y = element_text(size = 8, colour = "black"))

# add column that combines trajectory and SESOI
res_data$traject_SESOI <-
  interaction(res_data$trajectory, res_data$SESOI)

plot_data_N <-
  res_data %>%
  filter(!(trajectory == "Standard" & SESOI != 0.5))

plot_N <-
  ggplot(data = plot_data_N,
         aes(x = factor(traject_SESOI),
             y = mean_N,
             fill = factor(traject_SESOI))) +
  geom_bar(stat = "identity",
           position = "dodge",
           size = .1,
           color = "black") +
  geom_errorbar(aes(ymax = mean_N + sd_N,
                    ymin = mean_N - sd_N),
                width = 0.1,
                size = 0.3,
                position = position_dodge(width = 0.9)) +
  labs(x = " ",
       y = "Mean # of animals \nin replication",
       fill = "Trajectory") +
  scale_x_discrete(limits = c("Standard.0.5",
                              "SESOI.0.5",
                              "SESOI.1"),
                   labels = c("Standard",
                               "SESOI = 0.5",
                               "SESOI = 1.0")) +
  scale_fill_manual(limits = c("Standard.0.5",
                               "SESOI.0.5",
                               "SESOI.1"),
                    labels = c("Standard",
                               "SESOI \n= 0.5",
                               "SESOI \n= 1.0"),
                    values = c("#E69F00", "#0072B2", "#adcee6")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        # axis.text.x = element_text(size = 8, colour = "black",
        #                            angle = 45, hjust = 1),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

exploratory_data_sesoi <-
  exploratory_data_sesoi %>% 
  filter(SESOI == "1.0") %>% 
  filter(init_sample_size == 10) %>% 
  filter(ES_true <= 5)

sesoi_data_rep_selected <-
  sesoi_data_after_replication %>% 
  filter(SESOI == 0.5) %>% 
  filter(init_sample_size == 10) %>% 
  filter(ES_true <= 5) %>% 
  filter(p_value <= .05)

sesoi_data_rep_selected_1.0 <-
  sesoi_data_after_replication %>% 
  filter(SESOI == 1.0) %>% 
  filter(init_sample_size == 10) %>% 
  filter(ES_true <= 5) %>% 
  filter(p_value <= .05)

sig_data_rep_selected <-
  standard_data_after_replication %>% 
  filter(pval_thres == 0.05) %>% 
  filter(init_sample_size == 10) %>% 
  filter(ES_true <= 5) %>% 
  filter(p_value <= .05)

plot_ES_after_replication <-
ggplot(data = exploratory_data_sesoi) +
  geom_histogram(aes(x = ES_true),
                 bins = 60, color = "black", size = 0.1,
                 fill = "white") +
  geom_histogram(data = sesoi_data_rep_selected,
                 aes(x = ES_true), 
                 bins = 60, color = "black", size = 0.1,
                 fill = "#0072B2") +
  geom_histogram(data = sesoi_data_rep_selected_1.0,
                 aes(x = ES_true), 
                 bins = 60, color = "black", size = 0.1,
                 fill = "#adcee6") +
  geom_histogram(data = sig_data_rep_selected,
                 aes(x = ES_true), 
                 bins = 60, color = "black", size = 0.1,
                 fill = "#E69F00") +
  labs(x = expression(paste("Effect sizes (Hedges' ", italic("g"), ") detected across trajectory")),
       y = "Frequency") +
  # geom_vline(aes(xintercept = 0.5), color = "red", lty = 2) +
  # geom_vline(aes(xintercept = 1.0), color = "red", lty = 2) +
  theme_cowplot(line_size = 0.3) +
  theme(axis.title.x = element_text(size = 9)) +
  theme(axis.title.y = element_text(size = 9)) +
  theme(axis.text.x = element_text(size = 8, colour = "black")) +
  theme(axis.text.y = element_text(size = 8, colour = "black"))

ggdraw(xlim = c(0, 2),
       ylim = c(0, 2)) +
  draw_plot(plot_exploratory_data_not_selected, 0, 1, .9, 1) +
  draw_plot(plot_N, 1, 1, .9, 1) +
  draw_plot(plot_ES_after_replication, 0, 0, .9, 1) +
  draw_plot_label(c("a", "b", "c"),
                c(0, 1, 0),
                c(2, 2, 1),
                size = 8.5)

```

## Sample size calculation for confirmation {-}

In a subsequent step, we estimated the sample size for a confirmatory study. In the Standard trajectory this was done via a power analysis using the initial exploratory effect size. The SESOI trajectory used the pre-defined SESOI that was employed as decision criterion earlier. Importantly, we set the power to detect an effect of the size of our SESOI to .50  (for more details see Methods section).

In the Standard trajectory, this resulted in small sample sizes (Standard: $n_{rep}$ (*M* $\pm$ *SD*) = `r round(res_data$mean_N[1], 2)` $\pm$ `r round(res_data$sd_N[1], 2)`; Fig. \@ref(fig:figure2)b). In the SESOI trajectory, the number of animals varied with the SESOI that was chosen (SESOI 0.5: $n_{rep}$ = `r round(res_data$mean_N[3])`, SESOI 1.0: $n_{rep}$ = `r round(res_data$mean_N[4])`; Fig. \@ref(fig:figure2)b). The small numbers in the Standard trajectory reflect the large exploratory effect sizes that passed on to confirmation and formed the basis for confirmatory sample size estimation (Fig. \@ref(fig:figure1)c).

## Outcomes across trajectory {-}

To estimate discovery success, we calculated the positive predictive value (PPV), negative predictive value (NPV), false positive rate (FPR), and false negative rate (FNR) across both trajectories. The PPV of a study is the post-study probability that a positive finding which is based on statistical significance reflects a true effect [@ioannidis2005most]. Likewise, the negative predictive value (NPV) is the post-study probability that a negative finding reflects a null effect [@kane2021science]. Both PPV and NPV are calculated from the prior probability (or prevalence), as well as the sensitivity and specificity of the test. In our study, the prior probability of an effect of a given size (Hedges' *g* of 0.5 and 1.0, respectively) was calculated from the empirical effect size distribution. For example, if we wanted to know the prior probability of an effect Hedges' *g* = 0.5, we divided the number of effects $\geq$ 0.5 by the total number of effects in the distribution. For an effect Hedges' *g* = 0.5, the prior probability was `r round(res_data$prev[1], 2)`, for Hedges' *g* = 1.0, the prior probability was `r round(res_data$prev[2], 2)`. 

```{r figure3, echo = FALSE, message = FALSE, out.width = '95%', fig.align = 'center', fig.cap = '\\textsf{\\textbf{Outcomes across trajectory.} \\textbf{a}, The positive predictive value across the trajectory is consistently higher in the Standard trajectory. \\textbf{b}, The negative predictive value is higher in the SESOI trajectory, but the difference between the two trajectories decreases for larger SESOI. \\textbf{c}, The false positive rate across the trajectory is better controlled in the Standard trajectory. \\textbf{d}, The false negative rate across the trajectory is much higher in the Standard trajectory but decreases as SESOI increases.}'}

plot_PPV <-
  ggplot(data = res_data,
         aes(x = factor(SESOI),
             y = PPV,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  geom_segment(aes(x = 0.5,
                   xend = 1.5,
                   y = prev[1],
                   yend = prev[1]),
               color = "black", lty = "dotted", size = 0.8) +
  geom_segment(aes(x = 1.5,
                   xend = 2.5,
                   y = prev[2],
                   yend = prev[2]),
               color = "black", lty = "dotted", size = 0.8) +
  labs(x = "SESOI",
       y = "Positive predictive value",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI", 
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

# plot_PPV

plot_NPV <-
  ggplot(data = res_data,
         aes(x = factor(SESOI),
             y = NPV,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  labs(x = "SESOI",
       y = "Negative predictive value",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI", 
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

# plot_NPV

plot_FPR <-
  ggplot(data = res_data,
         aes(x = factor(SESOI),
             y = FPR,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  labs(x = "SESOI",
       y = "False positive rate",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI",
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

# plot_FPR

plot_FNR <-
  ggplot(data = res_data,
         aes(x = factor(SESOI),
             y = FNR,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  labs(x = "SESOI",
       y = "False negative rate",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI",
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

# plot_FNR

plot_FNR_legend <-
  ggplot(data = res_data,
         aes(x = factor(SESOI),
             y = FNR,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  labs(x = "SESOI",
       y = "False negative rate",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI",
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black", 
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "right")

# Extract the legend. Returns a gtable
leg <- get_legend(plot_FNR_legend)

# Convert to a ggplot and print
legend <- as_ggplot(leg)

# add column that combines trajectory and SESOI
res_data$traject_SESOI <-
  interaction(res_data$trajectory, res_data$SESOI)

ggdraw(xlim = c(0, 2),
       ylim = c(0, 2)) +
  draw_plot(plot_PPV, 0, 1, .8, .9) +
  draw_plot(plot_NPV, .85, 1, .8, .9) +
  draw_plot(plot_FPR, 0, 0, .8, .9) +
  draw_plot(plot_FNR, .85, 0, .8, .9) +
  draw_plot(legend, 1.6, 0.2, 0.5, 0.9) +
  draw_plot_label(c("a", "b", "c", "d"),
                  c(0, 0.84, 0, 0.84),
                  c(2, 2, 1, 1),
                  size = 9)

```

As Fig. \@ref(fig:figure2)c and Fig. \@ref(fig:figure3) illustrate, the two trajectories exhibit distinct strengths. The Standard trajectory successfully weeds out effects smaller than 0.5 and 1.0, but detects less than half and two thirds of the relevant effect sizes, respectively. Vice versa for the SESOI trajectory which successfully identifies relevant effect sizes, but is less specific. The PPV reaches higher levels across the Standard trajectory (Standard 0.5: `r round(res_data$PPV[1], 2)`, Standard 1.0: `r round(res_data$PPV[2], 2)`) compared to the SESOI trajectory (SESOI 0.5: `r round(res_data$PPV[3], 2)`, SESOI 1.0: `r round(res_data$PPV[4], 2)`; Fig. \@ref(fig:figure3)a). This means that among the significant results after the two-stage process a higher proportion reflects a true effect in the Standard trajectory. The NPV favored the SESOI trajectory over the Standard trajectory, particularly for lower SESOI (SESOI 0.5 `r round(res_data$NPV[3], 2)`, SESOI 1.0: `r round(res_data$NPV[4], 2)`; Standard 0.5: `r round(res_data$NPV[1], 2)`, Standard 1.0: `r round(res_data$NPV[2], 2)`; Fig. \@ref(fig:figure3)b). The FPR was consistently higher in the SESOI trajectory compared to the Standard trajectory (SESOI 0.5: `r round(res_data$FPR[3], 2)`, SESOI 1.0: `r round(res_data$FPR[4], 2)`, Standard 0.5: `r round(res_data$FPR[1], 2)`, Standard 1.0: `r round(res_data$FPR[2], 2)`; Fig. \@ref(fig:figure3)c). The FNR revealed the most pronounced differences between the trajectories. It was considerably lower in the SESOI trajectory for smaller SESOI  (SESOI 0.5: `r round(res_data$FNR[3], 2)`, SESOI 1.0: `r round(res_data$FNR[4], 2)`, Standard 0.5: `r round(res_data$FNR[1], 2)`, Standard 1.0: `r round(res_data$FNR[2], 2)`; Fig. \@ref(fig:figure3)d).

```{r figure4, echo = FALSE, message = FALSE, warning = FALSE, out.width = '95%', fig.align = 'center', fig.cap = '\\textsf{\\textbf{Outcomes of resource reallocation and significant effect sizes after replication for pessimistic effect size distribution.} \\textbf{a}, \\textbf{b}, Distribution of empirical effect sizes (\\textit{n} = 336) extracted from Carneiro \\textit{et al}., 2018. \\textbf{c}, The histogram displays the distribution of sampled effect sizes (\\textit{n} = 10000), that constituted our underlying true effect sizes in the simulation. Shaded bars indicate which underlying effect sizes were detected in the two-stage process (SESOI = 0.5: dark blue shaded bars, SESOI = 1.0: light blue shaded bars, Standard: yellow shaded bars). As the histogram illustrates, the Standard trajectory does not successfully identify relevant effects.}'}

# data for results section main outcomes
sesoi_data <-
  res %>%
  filter(init_sample_size == 10) %>%
  filter(trajectory == "SESOI") %>% 
  filter(SESOI == 0.5)

standard_data <-
  res %>% 
  filter(init_sample_size == 10) %>% 
  filter(trajectory == "Standard") %>% 
  filter(pval_threshold == 0.05) %>% 
  filter(SESOI == 0.5)

standard_exp_30eu <-
  outcomes_standard_exp_30eu %>% 
  filter(SESOI == 0.5)

standard_exp_30eu[1, 1] <- "Standard_30"

plot_data <-
  bind_rows(sesoi_data,
            standard_data,
            standard_exp_30eu) %>% 
  select(trajectory,
         PPV, NPV, FPR, FNR) %>% 
  gather(key, value = value, -trajectory, -pval_threshold, -SESOI)

resources_plot <- 
  ggplot(data = plot_data,
         aes(x = key,
           y = value,
           color = trajectory,
           shape = trajectory)) +
  geom_point(size = 1.8) +
  labs(x = " ",
       y = " ",
       color = "Trajectory",
       shape = "Trajectory") +
  scale_shape_manual(breaks = c("SESOI",
                                "Standard",
                                "Standard_30"),
                     labels = c("SESOI",
                                "Standard",
                                "Standard after \nexploration with n = 30"),
                     values = c(19, 19, 17)) +
  scale_color_manual(breaks = c("SESOI",
                                "Standard",
                                "Standard_30"),
                     labels = c("SESOI",
                                "Standard",
                                "Standard after \nexploration with n = 30"),
                     values = c("#0072B2",
                                "#E69F00",
                                "#ffd881")) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black",
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

resources_plot_legend <- 
  ggplot(data = plot_data,
         aes(x = key,
           y = value,
           color = trajectory,
           shape = trajectory)) +
  geom_point(size = 1.8) +
  labs(x = " ",
       y = " ",
       color = "Trajectory",
       shape = "Trajectory") +
  scale_shape_manual(breaks = c("SESOI",
                                "Standard",
                                "Standard_30"),
                     labels = c("SESOI",
                                "Standard",
                                "Standard after \nexploration with n = 30"),
                     values = c(19, 19, 17)) +
  scale_color_manual(breaks = c("SESOI",
                                "Standard",
                                "Standard_30"),
                     labels = c("SESOI",
                                "Standard",
                                "Standard after \nexploration with n = 30"),
                     values = c("#0072B2",
                                "#E69F00",
                                "#ffd881")) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black",
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "right")

ES_histrogram_Carneiro <-
  ggplot(data = ES_data_Carneiro, aes(x = ES_d)) +
  geom_histogram(bins = 50, color = "black", fill = "white", size = 0.1) +
  labs(x = expression(paste("Empirical effect sizes (Cohen's ", italic("d"), ") ")),
       y = "Frequency") +
  scale_x_continuous(breaks = seq(-4, 6, 2)) +
  theme_cowplot(line_size = 0.3) +
  theme(axis.title.x = element_text(size = 9)) +
  theme(axis.title.y = element_text(size = 9)) +
  theme(axis.text.x = element_text(size = 8, colour = "black")) +
  theme(axis.text.y = element_text(size = 8, colour = "black")) +
  theme(legend.position = "none")

res_Carneiro_10 <-
  res_Carneiro %>%
  filter(init_sample_size == 10)

exp_sesoi_Carneiro <-
  exp_sesoi_Carneiro %>% 
  filter(SESOI == "1.0") %>% 
  filter(init_sample_size == 10) %>% 
  filter(ES_true <= 5)

sesoi_rep_selected_Carneiro <-
  rep_sesoi_Carneiro %>% 
  filter(SESOI == 0.5) %>% 
  filter(init_sample_size == 10) %>% 
  filter(ES_true <= 5) %>% 
  filter(p_value <= .05)

sesoi_rep_selected_1.0_Carneiro <-
  rep_sesoi_Carneiro %>% 
  filter(SESOI == 1.0) %>% 
  filter(init_sample_size == 10) %>% 
  filter(ES_true <= 5) %>% 
  filter(p_value <= .05)

sig_rep_selected_Carneiro <-
  rep_sig_Carneiro %>% 
  filter(pval_threshold == 0.05) %>% 
  filter(init_sample_size == 10) %>% 
  filter(ES_true <= 5) %>% 
  filter(p_value <= .05)

plot_ES_after_replication <-
ggplot(data = exp_sesoi_Carneiro) +
  geom_histogram(aes(x = ES_true),
                 bins = 50, color = "black", size = 0.1,
                 fill = "white") +
  geom_histogram(data = sesoi_rep_selected_Carneiro,
                 aes(x = ES_true), 
                 bins = 50, color = "black", size = 0.1,
                 fill = "#0072B2") +
  geom_histogram(data = sesoi_rep_selected_1.0_Carneiro,
                 aes(x = ES_true), 
                 bins = 50, color = "black", size = 0.1,
                 fill = "#adcee6") +
  geom_histogram(data = sig_rep_selected_Carneiro,
                 aes(x = ES_true), 
                 bins = 50, color = "black", size = 0.1,
                 fill = "#E69F00") +
  labs(x = expression(paste("Effect sizes (Hedges' ", italic("g"), ") detected across trajectory")),
       y = "Frequency") +
  theme_cowplot(line_size = 0.3) +
  theme(axis.title.x = element_text(size = 9)) +
  theme(axis.title.y = element_text(size = 9)) +
  theme(axis.text.x = element_text(size = 8, colour = "black")) +
  theme(axis.text.y = element_text(size = 8, colour = "black"))

# Extract the legend. Returns a gtable
leg2 <- get_legend(resources_plot_legend)

# Convert to a ggplot and print
legend2 <- as_ggplot(leg2)

ggdraw(xlim = c(0, 2),
       ylim = c(0, 2)) +
  draw_plot(resources_plot, 0, 1, 1, 1) +
  draw_plot(legend2, .75, 1.25, 1, 1) +
  draw_plot(ES_histrogram_Carneiro, 0, 0, 1, 1) +
  draw_plot(plot_ES_after_replication, 1, 0, 1, 1) +
  draw_plot_label(c("a", "b", "c"),
                  c(0, 0, 1),
                  c(2, 1, 1),
                  size = 9)

```

## Resource reallocation from SESOI to Standard trajectory   {-}

The results regarding the FNR across the trajectory raised the question whether we would be able to increase sensitivity in the Standard trajectory if we reallocated the resources used in the SESOI trajectory. Specifically, if we took the total amount of experimental units (EU) used in the SESOI trajectory (given a SESOI of 0.5 this would amount to 10 EU * 2 [groups] * 10000 [studies] in exploration + 23 EU * 2 [groups] * 8333 [studies] in confirmation), we could run 10000 exploratory studies with 30 EU in *each* group in the Standard trajectory. How would an increased sample size at this early stage change the PPV, NPV, FPR, and FNR? We compared outcomes across the two-stage SESOI and Standard trajectories with outcomes of the 30 EU exploratory study in Standard trajectory. As displayed in Fig. \@ref(fig:figure4)a, an increase in initial sample size benefits the sensitivity indicated by a sharp drop in false negatives (FNR: `r round(standard_exp_30eu$FNR[1], 2)`) and an elevated NPV (NPV: `r round(standard_exp_30eu$NPV[1], 2)`). However, this comes at the cost of a higher FPR (FPR: `r round(standard_exp_30eu$FPR[1], 2)`) and a decreased PPV (PPV: `r round(standard_exp_30eu$PPV[1], 2)`). 

## Pessimistic effect size distribution {-}

In addition to the simulation based on the effect size distribution by Bonapersona *et al*., (2021) [@bonapersona2021increasing], we ran the simulation also with a more pessimistic published effect size distribution [@carneiro2018effect] (Fig. \@ref(fig:figure4)b). The main difference is that this distribution contains negative effect sizes and that the prior probabilities for an effect of 0.5 and 1.0 are considerably lower (Hedges' *g* = 0.5: `r round(res_Carneiro_10$prev[1], 2)`, Hedges' *g* = 1.0: `r round(res_Carneiro_10$prev[2], 2)`). The SESOI trajectory is more sensitive and successfully identifies relevant effect sizes compared to the Standard trajectory (Fig. \@ref(fig:figure4)c). The results regarding the PPV and NPV are very similar to those obtained based on the Bonapersona distribution (PPV: SESOI 0.5: `r round(res_Carneiro_10$PPV[3], 2)`, SESOI 1.0: `r round(res_Carneiro_10$PPV[4], 2)`, Standard 0.5: `r round(res_Carneiro_10$PPV[1], 2)`, Standard 1.0: `r round(res_Carneiro_10$PPV[2], 2)`; NPV: SESOI 0.5: `r round(res_Carneiro_10$NPV[3], 2)`, SESOI 1.0: `r round(res_Carneiro_10$NPV[4], 2)`, Standard 0.5: `r round(res_Carneiro_10$NPV[1], 2)`, Standard 1.0: `r round(res_Carneiro_10$NPV[2], 2)`; Fig. \@ref(fig:figure5)a-b). However, in the pessimistic scenario, the SESOI trajectory performs considerably better with regard to the FPR (SESOI 0.5: `r round(res_Carneiro_10$FPR[3], 2)`, SESOI 1.0: `r round(res_Carneiro_10$FPR[4], 2)`; Fig. \@ref(fig:figure5)c) although the FPR is still slightly lower in the Standard trajectory (Standard 0.5: `r round(res_Carneiro_10$FPR[1], 3)`, Standard 1.0: `r round(res_Carneiro_10$FPR[2], 2)`). The FNR remains concerningly high in the Standard trajectory (Standard 0.5: `r round(res_Carneiro_10$FNR[1], 2)`, Standard 1.0: `r round(res_Carneiro_10$FNR[2], 2)`; Fig. \@ref(fig:figure5)d), whereas in the SESOI trajectory it is decreased compared to the Bonapersona distribution (SESOI 0.5: `r round(res_Carneiro_10$FNR[3], 2)`, SESOI 1.0: `r round(res_Carneiro_10$FNR[4], 2)`). Transition rates and sample sizes in confirmation are displayed in Fig. S12. 

```{r figure5, echo = FALSE, message = FALSE, out.width = '95%', fig.align = 'center', fig.cap = '\\textsf{\\textbf{Outcomes across trajectory based on pessimistic effect size distribution.} \\textbf{a}, The positive predictive value across the trajectory is consistently higher in the Standard trajectory. \\textbf{b}, The negative predictive value is higher in the SESOI trajectory. \\textbf{c}, The false positive rate across the trajectory is well controlled in both trajectories. \\textbf{d}, The false negative rate is much lower in the SESOI trajectory. Across the Standard trajectory, more than half (SESOI = 0.5) and one third (SESOI = 1.0) of the relevant effect sizes are missed, respectively.}'}

plot_PPV <-
  ggplot(data = res_Carneiro_10,
         aes(x = factor(SESOI),
             y = PPV,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  geom_segment(aes(x = 0.5,
                   xend = 1.5,
                   y = prev[1],
                   yend = prev[1]),
               color = "black", lty = "dotted", size = 0.8) +
  geom_segment(aes(x = 1.5,
                   xend = 2.5,
                   y = prev[2],
                   yend = prev[2]),
               color = "black", lty = "dotted", size = 0.8) +
  labs(x = "SESOI",
       y = "Positive predictive value",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI",
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black",
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

# plot_PPV

plot_NPV <-
  ggplot(data = res_Carneiro_10,
         aes(x = factor(SESOI),
             y = NPV,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  labs(x = "SESOI",
       y = "Negative predictive value",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI",
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black",
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

# plot_NPV

plot_FPR <-
  ggplot(data = res_Carneiro_10,
         aes(x = factor(SESOI),
             y = FPR,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  labs(x = "SESOI",
       y = "False positive rate",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI",
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black",
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

# plot_FPR

plot_FNR <-
  ggplot(data = res_Carneiro_10,
         aes(x = factor(SESOI),
             y = FNR,
             color = factor(trajectory))) +
  geom_point(size = 1.8) +
  labs(x = "SESOI",
       y = "False negative rate",
       color = "Trajectory") +
  scale_color_manual(breaks = c("SESOI",
                                "Standard"),
                     labels = c("SESOI",
                                "Standard"),
                     values = c("#0072B2",
                                "#E69F00")) +
  theme_bw() +
  theme(axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        axis.text.x = element_text(size = 8, colour = "black"),
        axis.text.y = element_text(size = 8, colour = "black"),
        strip.text.x = element_text(size = 9, colour = "black"),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.border = element_rect(colour = "black",
                                    fill = NA, size = 0.3),
        panel.grid.major = element_line(size = 0.25),
        panel.grid.minor = element_line(size = 0.1),
        strip.background = element_rect(fill = "white", color = "black", size = 0.3),
        legend.position = "none")

# plot_FNR

ggdraw(xlim = c(0, 2),
       ylim = c(0, 2)) +
  draw_plot(plot_PPV, 0, 1, .8, .9) +
  draw_plot(plot_NPV, .85, 1, .8, .9) +
  draw_plot(plot_FPR, 0, 0, .8, .9) +
  draw_plot(plot_FNR, .85, 0, .8, .9) +
  draw_plot(legend, 1.6, 0.2, 0.5, 0.9) +
  draw_plot_label(c("a", "b", "c", "d"),
                  c(0, 0.84, 0, 0.84),
                  c(2, 2, 1, 1),
                  size = 9)

```


# Discussion {-}

Overall, our simulation shows that current practice reflected by the Standard trajectory does not meet the complementary goals of exploration and confirmation along a preclinical research trajectory. In the Standard trajectory, the switch from exploratory to confirmatory mode eliminates numerous potentially meaningful effects. A more lenient significance threshold ($\alpha$ = 0.1) elevated the number of studies that proceeded to confirmation (Fig. S10). However, not to an extent that appreciably impacted the PPV and NPV (Fig. S11). The same holds for a slight decrease/increase of the initial sample size (Fig. S4--S5). When we tested a more pessimistic published effect size distribution results were preserved (Fig. \@ref(fig:figure5)). Overall, the decision criterion used to decide whether to transition to confirmation has been shown to be more impactful than the approach for confirmatory sample size estimation (Fig. S9). In light of our findings, we advise a reconsideration of planning and conducting experiments in early-stage preclinical research.

Whereas the Standard trajectory excels in specificity as indicated by a low FPR and reflected by a high PPV, its low sensitivity should cause concern. Upon exploration, a considerable number of potentially meaningful effects is eliminated (Fig. \@ref(fig:figure2)a). Unlike in our simulation, in real life we cannot know how many meaningful effects were falsely discarded. The costs of false negatives are therefore difficult to quantify. This might explain why preventing false positives is often a greater concern for researchers. However, as Kane and Kimmelman, (2021) [@kane2021science] point out, false negatives are just as important to consider. The focus needs to shift towards more sensitive screening strategies to prevent false negatives, especially in research areas that have yielded few advances with regard to effective treatments [@dirnagl2016thomas; @mullane2019preclinical; @o20061; @perrin2014preclinical; @petrov2017clinical; @van2019revised]. 

Low sensitivity in the Standard trajectory could be remedied by using more animals in the exploratory study (Fig. 4a). However, that might undermine the tentative nature of exploration. Furthermore, conducting an additional confirmatory study (as in the two-stage SESOI trajectory) does not only allow to increase reliability but also enables a gradual refinement of experimental design using measures like randomization and blinding to reduce bias [@drude2021science; @macleod2008evidence].

Our results underscore the need for a systematic estimation of true effects using sensitive screening strategies. We therefore propose to proceed following these steps when embarking on an investigation: 1. Choose a SESOI. The rationale for the choice of a SESOI should be transparently reported and can be based on various considerations, like feasibility given practical constraints or meta-analytic effect size estimates in your field [@lakens2021sample]. 2. Conduct an exploratory study and apply the pre-specified SESOI as decision criterion to decide whether to move forward to confirmation. Be aware that the width of your CI is a function of the sample size, i.e., the less animals you use, the wider the CI. The CI, in which the SESOI should fall, needs potentially be adjusted based on the reliability of the initial study (Fig. S1). This has to be done also *a priori*. 3. If the decision points to a transition to confirmatory mode, use the SESOI to calculate the confirmatory sample size with a power of .50, ideally using a one-sided test. 4. Conduct a confirmatory study. Here, we chose significance as a measure of confirmation success. However, other methods such as the estimation of effect sizes and their CI or the sceptical *p*-value [@held2020new] might be more informative. 

Our results are dependent on underlying assumptions represented by the empirical effect size distributions from Bonapersona *et al*. (2021) and Carneiro *et al*. (2018). If effect sizes in a field considerably deviate from these distributions (i.e., are larger), following our recommendation might be dispensable, as the issue of low sensitivity to detect effects does not arise. Our method specifically addresses preclinical research areas that need to weigh the number of animals against the likelihood of inference errors. This is the case in fields where the prior probability of true hypotheses is low and/or if effect estimates are expected to be small. The latter applies if a new treatment is tested against a (standard of care) comparator.

Apart from the outcomes, using a SESOI for study planning comes with a crucial advantage: It requires researchers to explicitly state and motivate which effects they consider relevant. If we took the conceptual implications of null hypothesis significance testing literally, every effect > 0 would be deemed meaningful. In reality, we believe, this is not the case. Researchers always need to balance their available resources against the potential benefit of an experiment. This process involves deliberations about which effect sizes are meaningful and worthwhile to confirm. However, only rarely are these considerations transparently stated. We suppose that the explicit choice of a SESOI fosters conceptual deliberations and thereby improves experimental design. In addition, a clear conception of a meaningful effect might be of benefit in the communication with regulatory authorities.

We are exploring solutions to a complex problem. We acknowledge that the solution cannot be simple and that there is no one-size-fits-all. The two trajectories compared here have different strengths and weaknesses. Thus, they might be used under different circumstances. We concede that applying a SESOI is more costly, yet our simulation shows that statistical significance even with a relaxed threshold is not a sensible criterion to screen for potentially meaningful effects during exploration. Sensitivity is an indispensable requirement for successful discovery. Thus, in fields that have made little progress with regard to effective treatments, sensitivity should be prioritized over specificity to eventually generate patient benefit.

The method we present here is an easily applicable alternative to current practice in preclinical animal research. Optimizing decision criteria by employing a SESOI increases chances to detect true effects while keeping the number of animals at a minimum.


\newpage

## Methods {-}

\scriptsize

\ \ \ \ **Simulation.** We explored different approaches to perform preclinical animal experiments via simulations. To this end, we modeled a simplified preclinical research trajectory from the exploratory stage to the results of a confirmatory study (within-lab replication; Fig. \@ref(fig:figure1)a). Along the trajectory, there are different ways to increase the probability of not missing potentially meaningful effects. After an initial exploratory study, a first decision identifies experiments for replication. In our simulation, we employed two different decision criteria that indicate when one should move from the exploratory to confirmatory mode. If a decision has been made to replicate an initial study, we applied two approaches to determine the sample size for a replication study (smallest effect size of interest (SESOI) and power analysis based on the exploratory effect size), as outlined in detail below.

\ \ \ \ *Empirical effect size distribution.* Simulations were based on an empirical effect size distribution from the recently published literature [@bonapersona2021increasing]. From this distribution, we were able to calculate the prior probability of a particular effect. For example, if we wanted to know the prior probability of an effect Hedges' *g* = 0.5, we divided the number of effects $\geq$ 0.5 by the total number of effects in the distribution.

The distribution of effect sizes extracted from Bonapersona *et al*., (2021) contains `r nrow(meta)` effect sizes from the fields neuroscience and metabolism. All effect sizes are calculated as the standardized difference in means (Hedges' *g*). Effect size estimates range from `r round(min(abs(meta$yi)), 2)` to `r round(max(abs(meta$yi)), 2)`, and have a median of `r round(median(abs(meta$yi)), 2)`. 

As a robustness check, we ran the simulation also with a more pessimistic published effect size distribution [@carneiro2018effect]. The study by Carneiro *et al*., (2018) systematically examined effect sizes in the rodent fear conditioning literature. The distribution consists of `r nrow(ES_data_Carneiro)` effect sizes calculated as the standardized mean difference (Cohen's' *d*). The effect sizes range from `r round(min(ES_data_Carneiro$ES_d), 2)` to `r round(max(ES_data_Carneiro$ES_d), 2)`, with a median of `r round(median(ES_data_Carneiro$ES_d), 2)`. In our simulation, standardized mean differences were calculated as Hedges' *g*.

\ \ \ \ *Exploratory mode.* From the empirical effect size distribution, we drew 10000 samples of effect sizes from which we created 10000 study data sets. Each data set comprised data of two groups consisting of ten experimental units (EU) each drawn from a normal distribution. We chose a number of ten EUs based on reported sample sizes in preclinical studies [@howells2014bringing; @bonapersona2021increasing]. Our simulated design mimics a comparison between two groups where one group receives an intervention and the other serves as a control group. The difference between the intervention and control group in each study data set was determined by the effect size that was drawn from the empirical effect size distribution. In that way, we ensured that our simulated data was comparable to data in the published literature in the respective fields (neuroscience and metabolism). In the simulated exploratory study, the study data sets are compared using a two-sided two-sample Welch's *t*-test. From these exploratory study results, we extracted *p*-values, exploratory effect size estimates, and their 95 % confidence intervals (CI). We then employed two different criteria based on the *p*-value or 95 % CI, respectively, to decide whether to continue to confirmatory mode.

\ \ \ \ *Decision criteria to proceed to confirmation.* The first decision criterion employed the conventional significance threshold ($\alpha$ = .05) to decide whether to replicate an exploratory study. If a *p*-value extracted from a two-sided two-sample Welch's *t*-test was $\leq$ .05 and the exploratory effect size was > 0, this study proceeded to confirmation. If not, the trajectory was terminated after the exploratory study. We chose this decision criterion as our reference, as this is what we consider to be current practice. 

As an alternative to this approach, we propose to set a smallest effect size of interest (SESOI) and examine whether the 95 % CI around the exploratory effect size estimate covers this SESOI. A SESOI is the effect size that the researcher based their domain knowledge and given practical constraints considers biologically and clinically meaningful [@lakens2021sample]. Our proposed method is similar to a non-inferiority test. In our case the null hypothesis stated that the exploratory study identified an effect that is inferior to our pre-defined SESOI. If this was not the case for an exploratory study, i.e., if the CI around the exploratory effect size covered our SESOI, non-inferiority was established and the study was carried forward to confirmatory mode. Again, exploratory effect sizes < 0 were not considered for confirmation. Importantly, we did not consider significance in this approach. In our simulation, we used Hedges' *g* = 0.5 and Hedges' *g* = 1.0 as SESOI. This approach emphasizes the importance of effect sizes rather than statistical significance to evaluate an intervention's effect. Further, we expected this approach to be more lenient than statistical significance and to allow a broader range of effect sizes to pass on to be further investigated.

Both decision criteria identified exploratory effect sizes < 0 to transition to confirmation. This would mean that an experiment which showed an effect in favor of the control would be replicated. As we think this is an unrealistic scenario, negative effect sizes were not carried forward to confirmation in the simulation. Based on the underlying effect size, these negatives were categorized as false negatives or true negatives to later calculate the outcomes across the two trajectories.

\ \ \ \ *Approaches to determine sample size for replication.* Once the decision to continue to confirmatory mode has been made, we employed two different approaches to determine the sample size for the confirmatory study. After the exploratory study, only effect sizes that showed an effect in favor of the treatment were considered for further investigation. Thus, for the confirmatory study, a one-sided two-sample Welch's *t*-test was performed. 
In the Standard trajectory, the desired power level for the confirmatory study was set to .80, $\alpha$ was set to .05. To determine the sample size given power and $\alpha$, we used the exploratory effect size estimate.
In the SESOI trajectory, we employed the same SESOI used as decision criterion earlier to calculate the confirmatory sample size. Our SESOI was set such that the confirmatory study has a power of .50 to detect an effect of this size. This power level was chosen to ensure that the likelihood of a false positive finding below the threshold determined by our SESOI is negligible. The aim during confirmation is to weed out false positives. Additionally, 0.5 is only the *smallest* effect size we are interested in, meaning all other effect sizes of interest (i.e., effect sizes > 0.5) have a higher chance of being detected [@roychoudhury2018beyond]. This increase in power is larger with a power level of 50 % compared to a power level of 80 % as illustrated by the power curves in Fig. S2.

\ \ \ \ *Confirmatory mode.* For each of the studies that met the decision criterion after the exploratory study (either *p* $\leq$ .05 or SESOI within the 95 % CI of the exploratory effect size estimate), a confirmatory study was performed. The number of studies conducted varied with the decision criterion used and, in case of the criterion employing a SESOI, also with the SESOI (0.5 and 1.0). A confirmatory study was performed as a one-sided two-sample Welch's *t*-test, where the number of animals in each group was determined by the approach to determine the sample size. For a confirmatory study to be considered "successful", the *p*-value had to be below the conventional significance threshold ($\alpha$ = .05).

\ \ \ \ *Outcome variables.* We compared the two trajectories (Standard and SESOI) regarding the transition rates from exploration to confirmation, number of animals needed in the confirmatory study, and positive predictive value (PPV), negative predictive value (NPV), false positive rate (FPR), and false negative rate (FNR) across the trajectories. Importantly, the PPV and NPV were calculated from the known prior probability (given by the empirical effect size distribution), the sensitivity (true positive rate), and the specificity (true negative rate). To make the rates comparable for the Standard and SESOI trajectory, we did not specify a non-existent effect as zero, but as an effect that is smaller than our SESOI (0.5 and 1.0, respectively). A true positive thus is a significant result that reflects an underlying effect of at least 0.5 (or 1.0, if our SESOI was 1.0). If a significant result represents an underlying effect smaller than 0.5 (or 1.0), this is categorized as a false positive (likewise for true and false negatives). This is a departure from the classical definition in the null hypothesis significance testing framework, where the benchmark against which is tested is zero.

\ \ \ \ *Additional trajectories.* In addition to the two trajectories compared in the main text, we also performed all simulations and analyses with the two crossed-over trajectories where each decision criterion is combined with the respective other approach to determine the sample size for confirmation. This resulted in the two trajectories SESOI-Standard (SESOI as decision criterion to move from exploration to confirmation + sample size estimation using the exploratory effect size estimate) and Standard-SESOI (Conventional significance threshold as decision criterion + SESOI for sample size estimation). Sample sizes in confirmation as well as outcomes across the trajectories are shown in Fig. S8 and Fig. S9. 

\ \ \ \ *Robustness checks.* As robustness checks, we simulated all trajectories with an initial sample size ($n_{init}$) of 5, 7 and 15 animals per group (in addition to 10 as described in the main part). We further performed all simulations and analyses with additional SESOI 0.1, 0.3, and 0.7. Outcomes are displayed in Fig. S4--S7. We also varied the significance threshold employed as decision criterion after exploration in the standard trajectory. The outcomes resulting from a more lenient significance threshold of $\alpha$ = 0.1 are displayed in Fig. S10 and Fig. S11. For the SESOI trajectory, we additionally varied the confidence interval around the exploratory effect size estimate used to determine whether to transition to confirmation. Transition rates and outcomes across trajectory are displayed in Fig. S1 and Fig. S2. Lastly, for the SESOI trajectory, we calculated the sample size for confirmation setting the power to .80 to investigate whether this would have beneficial effects on our outcomes of interest. Outcomes are shown in Fig. S3.


\newpage

\normalsize

# References {-}

\singlespacing

::: {#refs}
:::

